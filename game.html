<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memory Board Game</title>
    <style id="game-styles">
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        background-color: #f0f0f0;
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
      }

      .controls {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .controls label {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .checkbox-label {
        position: relative;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .tooltip {
        font-size: 12px;
        color: #777;
        margin-left: 5px;
      }

      .presets {
        margin-bottom: 15px;
      }

      select {
        padding: 5px 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }

      .game-container {
        margin-bottom: 20px;
      }

      .stats {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
        gap: 10px;
      }

      .timer {
        font-size: 18px;
        font-weight: bold;
      }

      .status {
        font-size: 18px;
        font-weight: bold;
        height: 24px;
        text-align: center;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 5px;
        margin-top: 20px;
      }

      .cell {
        width: 60px;
        height: 60px;
        background-color: #ddd;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      .cell:hover {
        background-color: #ccc;
      }

      .cell.selected {
        background-color: #4caf50;
        color: white;
      }

      .cell.wrong {
        background-color: #f44336;
        color: white;
      }

      .cell.correct {
        background-color: #2196f3;
        color: white;
      }

      .cell.flash {
        background-color: #ffc107;
        color: #333;
      }

      button {
        padding: 10px 15px;
        font-size: 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }

      button:hover {
        background-color: #45a049;
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      input[type="number"] {
        width: 60px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <h1>Memory Board Game</h1>

    <div class="presets">
      <label>
        Difficulty:
        <select id="preset-select">
          <option value="custom">Custom</option>
          <option value="beginner">Beginner</option>
          <option value="advanced">Advanced</option>
        </select>
      </label>
    </div>

    <div class="controls">
      <label>
        Rows:
        <input type="number" id="rows-input" min="2" max="12" value="8" />
      </label>
      <label>
        Columns:
        <input type="number" id="cols-input" min="2" max="12" value="8" />
      </label>
      <label>
        Number of items:
        <input type="number" id="items-input" min="1" max="20" value="9" />
      </label>
      <label>
        Flash time (seconds):
        <input
          type="number"
          id="flash-time-input"
          min="0.1"
          max="5"
          step="0.1"
          value="1"
        />
      </label>
      <label>
        Max attempts:
        <input
          type="number"
          id="max-attempts-input"
          min="0"
          max="100"
          value="0"
        />
        <span>(0 = unlimited)</span>
      </label>
      <label class="checkbox-label">
        Easy mode:
        <input type="checkbox" id="easy-mode-checkbox" checked />
        <span class="tooltip"
          >In hard mode, all selections reset on any mistake</span
        >
      </label>
    </div>

    <div class="controls">
      <button id="start-button">Start New Game</button>
    </div>

    <div class="stats">
      <div class="timer" id="timer">Time: 00:00</div>
      <div class="status" id="status">Press "Start New Game" to begin</div>
    </div>

    <div class="game-container">
      <div class="grid" id="grid"></div>
    </div>

    <script id="game-script">
      // Game state
      let state = {
        rows: 8,
        cols: 8,
        numItems: 9,
        flashTime: 1,
        maxAttempts: 0, // 0 means unlimited
        attempts: 0,
        gameActive: false,
        easyMode: true, // New setting for easy/hard mode
        numberCells: [], // Array of {row, col, number}
        selectedCells: [], // Array of indices in the correct order
        currentExpectedNumber: 1,
        cells: [], // DOM elements
        timerInterval: null,
        startTime: 0,
        gameTime: 0,
      };

      // Difficulty presets
      const presets = {
        beginner: {
          rows: 4,
          cols: 4,
          numItems: 5,
          flashTime: 1,
        },
        advanced: {
          rows: 8,
          cols: 8,
          numItems: 9,
          flashTime: 1,
        },
      };

      // DOM Elements
      const grid = document.getElementById("grid");
      const startButton = document.getElementById("start-button");
      const statusDisplay = document.getElementById("status");
      const timerDisplay = document.getElementById("timer");
      const rowsInput = document.getElementById("rows-input");
      const colsInput = document.getElementById("cols-input");
      const itemsInput = document.getElementById("items-input");
      const flashTimeInput = document.getElementById("flash-time-input");
      const maxAttemptsInput = document.getElementById("max-attempts-input");
      const easyModeCheckbox = document.getElementById("easy-mode-checkbox");
      const presetSelect = document.getElementById("preset-select");

      // Initialize
      function initializeGrid() {
        // Clear grid
        grid.innerHTML = "";
        grid.style.gridTemplateColumns = `repeat(${state.cols}, 1fr)`;

        state.cells = [];

        // Create grid cells
        for (let row = 0; row < state.rows; row++) {
          for (let col = 0; col < state.cols; col++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.row = row;
            cell.dataset.col = col;
            cell.addEventListener("click", () => handleCellClick(row, col));
            grid.appendChild(cell);
            state.cells.push(cell);
          }
        }
      }

      // Generate random positions for numbers
      function generateNumberPositions() {
        const positions = [];
        const usedPositions = new Set();

        for (let i = 1; i <= state.numItems; i++) {
          let row, col, posKey;

          // Find unused position
          do {
            row = Math.floor(Math.random() * state.rows);
            col = Math.floor(Math.random() * state.cols);
            posKey = `${row}-${col}`;
          } while (usedPositions.has(posKey));

          usedPositions.add(posKey);
          positions.push({ row, col, number: i });
        }

        return positions;
      }

      // Flash numbers on the grid
      function flashNumbers() {
        statusDisplay.textContent = "Remember the positions...";

        // Show numbers
        state.numberCells.forEach(({ row, col, number }) => {
          const index = row * state.cols + col;
          const cell = state.cells[index];
          cell.textContent = number;
          cell.classList.add("flash");
        });

        // Hide numbers after flashTime
        setTimeout(() => {
          state.numberCells.forEach(({ row, col }) => {
            const index = row * state.cols + col;
            const cell = state.cells[index];
            cell.textContent = "";
            cell.classList.remove("flash");
          });

          statusDisplay.textContent =
            "Click on the cells in order from 1 to " + state.numItems;

          // Start the timer
          startTimer();
        }, state.flashTime * 1000);
      }

      // Handle cell click
      function handleCellClick(row, col) {
        if (!state.gameActive) return;

        const clickedCell = state.numberCells.find(
          (cell) => cell.row === row && cell.col === col
        );
        const cellIndex = row * state.cols + col;
        const domCell = state.cells[cellIndex];

        // If cell is already selected, ignore click
        if (state.selectedCells.includes(cellIndex)) {
          return;
        }

        // If cell has a number
        if (clickedCell) {
          if (clickedCell.number === state.currentExpectedNumber) {
            // Correct selection
            domCell.textContent = clickedCell.number;
            domCell.classList.add("correct");
            state.selectedCells.push(cellIndex);
            state.currentExpectedNumber++;

            // Check if all numbers found
            if (state.currentExpectedNumber > state.numItems) {
              // Game won
              endGame(true);
            }
          } else {
            // Wrong selection
            state.attempts++;

            // Flash the wrong answer
            domCell.textContent = clickedCell.number;
            domCell.classList.add("wrong");

            setTimeout(() => {
              // Remove the wrong number display
              domCell.textContent = "";
              domCell.classList.remove("wrong");

              // Handle different modes
              if (!state.easyMode) {
                // Hard mode: Reset all selections
                clearSelections();
              }

              // Check if max attempts reached
              if (
                state.maxAttempts > 0 &&
                state.attempts >= state.maxAttempts
              ) {
                endGame(false);
              } else {
                let attemptsText =
                  state.maxAttempts > 0
                    ? ` (${state.attempts}/${state.maxAttempts} attempts used)`
                    : ` (${state.attempts} attempts used)`;

                if (state.easyMode) {
                  statusDisplay.textContent =
                    "Wrong! Try next number" + attemptsText;
                } else {
                  statusDisplay.textContent =
                    "Wrong! Start again from 1" + attemptsText;
                }
              }
            }, 500);
          }
        } else {
          // Clicked on empty cell
          domCell.classList.add("wrong");

          setTimeout(() => {
            domCell.classList.remove("wrong");
          }, 300);
        }
      }

      // Clear all selections
      function clearSelections() {
        state.selectedCells.forEach((index) => {
          state.cells[index].textContent = "";
          state.cells[index].classList.remove("correct");
          state.cells[index].classList.remove("wrong");
        });

        // Reset selected cells and expected number
        state.selectedCells = [];
        state.currentExpectedNumber = 1;

        // Clear any wrong selections
        state.cells.forEach((cell) => {
          cell.classList.remove("wrong");
        });
      }

      // Timer functions
      function startTimer() {
        // Clear any existing timer
        stopTimer();

        // Set start time and update display immediately
        state.startTime = Date.now();
        state.gameTime = 0;
        updateTimerDisplay();

        // Start interval to update timer every second
        state.timerInterval = setInterval(updateTimerDisplay, 1000);
      }

      function stopTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
          state.timerInterval = null;
        }
      }

      function updateTimerDisplay() {
        if (state.gameActive) {
          state.gameTime = Math.floor((Date.now() - state.startTime) / 1000);
          const minutes = Math.floor(state.gameTime / 60);
          const seconds = state.gameTime % 60;
          timerDisplay.textContent = `Time: ${minutes
            .toString()
            .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
        }
      }

      // End game (win or lose)
      function endGame(won) {
        stopTimer();
        state.gameActive = false;
        startButton.disabled = false;

        if (won) {
          statusDisplay.textContent = `Congratulations! You won in ${state.gameTime} seconds!`;
        } else {
          statusDisplay.textContent = `Game over! You've used all ${state.maxAttempts} attempts.`;

          // Show all numbers
          state.numberCells.forEach(({ row, col, number }) => {
            const idx = row * state.cols + col;
            state.cells[idx].textContent = number;
            state.cells[idx].classList.add("flash");
          });
        }
      }

      // Apply preset
      function applyPreset(presetName) {
        if (presetName === "custom") {
          return; // Keep current values
        }

        const preset = presets[presetName];
        if (!preset) return;

        rowsInput.value = preset.rows;
        colsInput.value = preset.cols;
        itemsInput.value = preset.numItems;
        flashTimeInput.value = preset.flashTime;

        // Update form fields
        rowsInput.disabled = presetName !== "custom";
        colsInput.disabled = presetName !== "custom";
        itemsInput.disabled = presetName !== "custom";
        flashTimeInput.disabled = presetName !== "custom";
      }

      // Start a new game
      function startGame() {
        // Get input values
        state.rows = parseInt(rowsInput.value) || 8;
        state.cols = parseInt(colsInput.value) || 8;
        state.numItems = parseInt(itemsInput.value) || 9;
        state.flashTime = parseFloat(flashTimeInput.value) || 1;
        state.maxAttempts = parseInt(maxAttemptsInput.value) || 0;
        state.easyMode = easyModeCheckbox.checked;

        // Validate inputs
        state.rows = Math.min(Math.max(state.rows, 2), 12);
        state.cols = Math.min(Math.max(state.cols, 2), 12);
        state.numItems = Math.min(Math.max(state.numItems, 1), 20);
        state.flashTime = Math.min(Math.max(state.flashTime, 0.1), 5);
        state.maxAttempts = Math.max(state.maxAttempts, 0);

        // Update input values
        rowsInput.value = state.rows;
        colsInput.value = state.cols;
        itemsInput.value = state.numItems;
        flashTimeInput.value = state.flashTime;
        maxAttemptsInput.value = state.maxAttempts;

        // Reset game state
        stopTimer();
        state.attempts = 0;
        state.selectedCells = [];
        state.currentExpectedNumber = 1;
        timerDisplay.textContent = "Time: 00:00";

        // Initialize grid
        initializeGrid();

        // Generate number positions
        state.numberCells = generateNumberPositions();

        // Update UI
        startButton.disabled = true;
        state.gameActive = true;

        // Flash numbers
        flashNumbers();
      }

      // Event listeners
      startButton.addEventListener("click", startGame);

      easyModeCheckbox.addEventListener("change", () => {
        state.easyMode = easyModeCheckbox.checked;
      });

      presetSelect.addEventListener("change", () => {
        applyPreset(presetSelect.value);
      });

      // Initialize on load
      initializeGrid();
    </script>
  </body>
</html>
